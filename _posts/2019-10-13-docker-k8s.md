---
title: "Docker - Kubernetes"
tags: [docker, linux]
reference:
  - title: "Install and Set Up kubectl"
    link: https://kubernetes.io/docs/tasks/tools/install-kubectl/#install-kubectl-on-linux

  - title: "–ë—ã—Å—Ç—Ä–æ–µ –≤–≤–µ–¥–µ–Ω–∏–µ –≤ Kubernetes"
    link: https://eax.me/kubernetes/
---


* TOC 
{:toc}

# –ì–ª–æ—Å—Å–∞—Ä–∏–π

* Node - —Ñ–∏–∑–∏—á–µ—Å–∫–∞—è –∏–ª–∏ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞
* Pod - –±–∞–∑–æ–≤–∞—è –µ–¥–µ–Ω–∏—Ü–∞ –¥–ª—è —É–ø—Ä. –∏ –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –æ–¥–∏–Ω (–∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ) –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤. –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å –µ–¥–∏–Ω—ã–º IP –∞–¥—Ä–µ—Å–æ–º. –ú–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–Ω—Ç–µ–π–Ω–æ—Ä–≤ (frontend, backend –Ω–∞–ø—Ä–∏–º–µ—Ä) –≤ –æ–¥–Ω–æ–º –ø–æ–¥–µ
* Service - –ù–∞–±–æ—Ä –ø–æ–¥–æ–≤
  * ClusterIP - —Å–µ—Ä–≤–∏—Å, –∫–æ—Ç–æ—Ä—ã–π –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ –∫–ª–∞—Å—Ç–µ—Ä–∞
  * NodePort - –ø—Ä–æ–±—Ä–æ—Å –ø–æ—Ä—Ç–∞ –∏–∑ –∫–ª–∞—Å—Ç–µ—Ä–∞ –≤–æ –≤–Ω–µ
  * LoadBalancer - —Ç—Ä–∞—Ñ–∏–∫ –∏–∑ –≤–Ω–µ—à–Ω–∏—Ö –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫–æ–≤ ?
  * ExternalName - –µ–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –Ω–∞ –∑–∞–ø—Ä–æ—Å—ã ?
* Ingress - —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –≤ –∫–ª–∞—Å—Ç–µ—Ä (nginx-ingress controller)
* Label

# –£—Å—Ç–∞–Ω–æ–∫–∞/–ó–∞–ø—É—Å–∫

—É—Å—Ç–∞–Ω–æ–≤–∫–∞ `kubectl`
<pre><code class="shell">
curl -LO https://storage.googleapis.com/kubernetes-release/release/`curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt`/bin/linux/amd64/kubectl
chmod +x ./kubectl
sudo mv ./kubectl /usr/local/bin/kubectl
kubectl version --client
</code></pre>

—É—Å—Ç–∞–Ω–æ–≤–∫–∞ `minikube`
<pre><code class="shell">
curl -Lo minikube https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64 && chmod +x minikube
sudo mkdir -p /usr/local/bin/
sudo install minikube /usr/local/bin/
</code></pre>

–∞–≤—Ç–æ–∫–æ–º–ø–ª–∏—Ç –≤ `.bashrc`
<pre><code class="shell">
echo "source <(kubectl completion bash)" >> ~/.bashrc

echo "source <(minikube completion bash)" >> ~/.bashrc
</code></pre>

## –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

<pre><code class="shell">
$ minikube start
üòÑ  minikube v1.7.3 on Ubuntu 16.04
‚ú®  Automatically selected the virtualbox driver. Other choices: none, docker (experimental)
üíø  Downloading VM boot image ...
    > minikube-v1.7.3.iso.sha256: 65 B / 65 B [--------------] 100.00% ? p/s 0s
    > minikube-v1.7.3.iso: 167.39 MiB / 167.39 MiB [] 100.00% 15.99 MiB p/s 11s
üî•  Creating virtualbox VM (CPUs=2, Memory=2000MB, Disk=20000MB) ...
</code></pre>


–ª–æ–∫–∞–ª—å–Ω—ã–π –¥–∞—à–±–æ–∞—Ä–¥ 
<pre><code class="shell">
$ minikube dashboard
üîå  Enabling dashboard ...
ü§î  Verifying dashboard health ...
üöÄ  Launching proxy ...
ü§î  Verifying proxy health ...
üéâ  Opening http://127.0.0.1:45827/api/v1/namespaces/kubernetes-dashboard/services/http:kubernetes-dashboard:/proxy/ in your default browser...
–û–∫–Ω–æ –∏–ª–∏ –≤–∫–ª–∞–¥–∫–∞ –æ—Ç–∫—Ä–æ—é—Ç—Å—è –≤ —Ç–µ–∫—É—â–µ–º —Å–µ–∞–Ω—Å–µ –±—Ä–∞—É–∑–µ—Ä–∞.
</code></pre>

–∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–¥–∞
<pre><code class="shell">
$ kubectl create deployment hello-node --image=gcr.io/hello-minikube-zero-install/hello-node
</code></pre>

–∏–Ω—Ñ–æ –ø–æ –¥–µ–ø–ª–æ–µ
<pre><code class="shell">
$ kubectl get deployments
NAME         READY   UP-TO-DATE   AVAILABLE   AGE
hello-node   1/1     1            1           36s
</code></pre>

–∏–Ω—Ñ–æ –æ –ø–æ–¥–∞—Ö
<pre><code class="shell">
$ kubectl get pods
NAME                          READY   STATUS    RESTARTS   AGE
hello-node-7676b5fb8d-k4rv5   1/1     Running   0          92s
</code></pre>

–∏–Ω—Ñ–æ –æ —Å–µ—Ä–≤–∏—Å–∞—Ö
<pre><code class="shell">
$ kubectl get services
NAME         TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE
kubernetes   ClusterIP   10.96.0.1    none          443/TCP   35m
</code></pre>

—Å–¥–µ–ª–∞—Ç—å –ø–æ–¥ –ø—É–±–ª–∏—á–Ω—ã–º
<pre><code class="shell">
$ kubectl expose deployment hello-node --type=LoadBalancer --port=8080
service/hello-node exposed
$ kubectl get services
NAME         TYPE           CLUSTER-IP     EXTERNAL-IP   PORT(S)          AGE
hello-node   LoadBalancer   10.110.30.32   pending       8080:32471/TCP   3s
kubernetes   ClusterIP      10.96.0.1      none          443/TCP          37m
</code></pre>

* –§–ª–∞–≥ --type=LoadBalancer –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ —Å–µ—Ä–≤–∏—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∏–¥–µ–Ω –≤–Ω–µ –∫–ª–∞—Å—Ç–µ—Ä–∞.

<pre><code class="shell">
$ minikube service hello-node
|-----------|------------|-------------|-----------------------------|
| NAMESPACE |    NAME    | TARGET PORT |             URL             |
|-----------|------------|-------------|-----------------------------|
| default   | hello-node |             | http://192.168.99.103:32471 |
|-----------|------------|-------------|-----------------------------|
üéâ  Opening service default/hello-node in default browser...
</code></pre>

–û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤ 
<pre><code class="shell">
$ kubectl delete service hello-node
service "hello-node" deleted

$ kubectl delete deployment hello-node
deployment.apps "hello-node" deleted

$ minikube stop
‚úã  Stopping "minikube" in virtualbox ...
üõë  "minikube" stopped.

$ minikube delete
üî•  Deleting "minikube" in virtualbox ...
üíÄ  Removed all traces of the "minikube" cluster.
</code></pre>



kubectl create deployment kubernetes-bootcamp --image=gcr.io/google-samples/kubernetes-bootcamp:v1

Great! You just deployed your first application by creating a