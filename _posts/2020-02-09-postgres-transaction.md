---
title: Транзакции в Postgres
tags: [postgres, database, 1db]
reference:
  -
    link:
    title:

---

* TOC 
{:toc}

<b>Транзакция</b> - логическая единица работы, удовлетворяющая след. 4-м свойствам (ACID)

* <b>Атомарность (Atomicity)</b> - в транзакции выполняется все или ничего; транзакция не может выполниться частично
* <b>Согласованность (Consistentcy)</b> - транзакция переводит базу данных из одного согласованного состояния в другое согласованное состояние
* <b>Изолированность (Isolation)</b> - каждая транзакция выполняется вне зависимости от других транзакций
* <b>Долговечность (Durability)</b> - если изменения состояния базы данных, сделанные транзакцией, зафиксированны, то они будут сохранены даже если потом произойдет сбой

<div class="info">
  <p>Транзакция нужна в первую очередь чтобы обеспечить предсказуемый результат!</p>
</div>


## Пример создания транзакции

<pre><code class="shell">
create table films (
    imdb varchar(16) primary key,
    title varchar(40) not null,
    kind varchar(10)
);
</code></pre>

<pre><code class="shell">
table films;
begin;

insert into films (imdb, title, kind) values
(1234, 'Выживший', 'вестерн');

commit;

table films;
</code></pre>

<pre><code class="shell">
 imdb | title | kind 
------+-------+------
(0 rows)

BEGIN
INSERT 0 1
COMMIT
 imdb |  title   |  kind   
------+----------+---------
 1234 | Выживший | вестерн
(1 row)
</code></pre>

### Журнал транзакций (WAL файлы)


### Бонус журналов транзакций
На базе журнала транзакций реализуется ряд дополнительных возможностей

* Point in time recovery - восстановление по журналу транзакций 
* Репликация - если есть две одинаковые копии БД, то с помощью WAL файлов можно обеспечить их синхронизацию. В одной БД WAL файлы создаються и по сети (rsync) передаються в копию.


25:23

