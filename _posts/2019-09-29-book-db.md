---
title: "Заметки по книге - Системы баз данных Полный курс"
tags: [book, database]
reference:
  - title:
    link:
---

* TOC 
{:toc}

## ERWin - tutorial

### Постановка задачи

В пункте обмена <b>валют</b> создается локальная информационная система, призванная автоматизировать процесс учета <b>сделок</b> купли – продажи <b>валюты</b>.  
Создаваемая система должна обеспечивать ввод, хранение и поиск информации о <b>сделках</b>, совершенных в данном пункте обмена.

Каждой <b>сделке</b> присваивается уникальный цифровой код.
Информация о <b>сделке</b> должна содержать сведения о дате и времени сделки, суммах покупаемой и продаваемой валют, фамилии, имени, отчестве и номере паспорта <b>клиента</b>, а так же о фамилии, инициалах и учетном номере личного дела <b>кассира</b> в отделе кадров.

Система должна позволять вычислить денежный оборот за один или несколько дней, а так же осуществлять поиск информации о <b>сделках</b> по номеру паспорта <b>клиента</b>.  

Задача состоит в проектировании структуры баз данных разрабатываемой автоматизированной ИС

#### 0) Кандидаты в сущности

* Валюта
* Сделка
* Клиент
* Кассир

#### 1) Связи

Для создания связей между сущностями сначала составим описание данной предметной области при помощи ряда истинных высказываний на естественном языке:

* Любой КЛИЕНТ должен совершить одну или несколько СДЕЛОК.
* Каждую СДЕЛКУ должен совершить один КЛИЕНТ.
* Любой КАССИР может обслуживать одну или несколько СДЕЛОК, но может не обслужить и ни одной.
* Каждую СДЕЛКУ должен обслуживать только один КАССИР.
* Любая ВАЛЮТА может покупаться и продаваться при разных СДЕЛКАХ.
* При совершении СДЕЛКИ должна покупаться одна ВАЛЮТА и продаваться другая ВАЛЮТА.

Таким образом, сформируем имена связей:
* КЛИЕНТ совершает СДЕЛКУ.
* КАССИР обслуживает СДЕЛКУ.
* ВАЛЮТА покупается при СДЕЛКЕ.
* ВАЛЮТА продается при СДЕЛКЕ.
Все четыре связи являются связями «один-ко-многим». Во всех четырех случаях 
сущность СДЕЛКА является дочерней

#### 2) Атрибуты

СДЕЛКА:
* Код сделки PK
* дата и временя сделки
* суммах покупаемой валюты
* валют продаваемой валюты

КЛИЕНТ:
* Номер клиента PK
* фамилия
* имя
* отчество
* номере паспорта AK

КАССИР
* Номер кассира PK
* фамилия
* инициалы
* учетный номер личного дела

ВАЛЮТА:
* Код валюты PK
* Название валюты

# Лаба мифи

Некоторая торговая фирма “Ирис” осуществляет продажу <b>товаров(E/2)</b> по образцам. <b>Покупателями(E/1)</b> <b>товаров(E/2)</b> могут быть как <b>частные(E/7)<b>, так и <b>юридические(E/6)</b> лица.

В штат торговой фирмы входят консультат, продавец, кассир и заведующий фирмой.
Работа фирмы осущетвляется в соответствии со след схемой:

Консультат - отвечает за работу с <b>покупателями(E/1) </b> (<b>юр.(E/6)</b> и <b>физ.(E/7)</b> Лиц).
<b>Покупатель(E/1) </b> обращается к менеджеру с целью оформить <b>заказ(E/3) </b> на приобретение <b>товаров(E/2)</b> из числа имеющихся в ассортименте.
При первом обращении <b>покупателя(E/1)</b> консультант регистрирует его. При оформлении <b>заказа(E/3) </b> в нем указывается <i>дата его оформления</i>, а также <b><i>перечисляются требуемые товары</i></b>, <i>кол-во</i>  и <i>отпускная цена</i> каждого <b>товара(E/2)</b>.
Консультатн примимает заказ без ограничений.

Продавец - отвечает за работу с <b>товарами(E/2)</b>.
Регистрация <b>товара(E/2)</b> осуществляется при каждом поступлении <b>товара(E/2)</b> на склад.
При первом поступлении <b>товара(E/2)</b> заноситься <b><i>вся необходимая информация о нем</i></b>, при повторном - только корректируется <i>кол-во товара на складе</i>.

При поступлении <b>товаров(E/2)</b> продавец оформляет <b>товарную накладную(E/6)</b>, в которой указывается <i>кол-во поступившего товара</i> и <i>дата поступления</i>, а также корректирует общее <i>кол-во товаров на складе</i>.

Продавец рассылает <b>покупателям(E/1)</b> в порядке поступления <b>заказов(E/3)</b> <b>оповещения(E/4)</b>, в котором указывается <i>крайний срок выкупа товара</i>, и отмечает в <b>заказе(E/3)</b> <i>дату отправки первого оповещения</i>, а также корректирует <i>кол-во товара на складе</i>.

При обращению <b>покупателя(E/1)</b> по предъявленному <b>оповещению(E/4)</b>, в котором есть <i>отметка об оплате товара</i> и <i>номер заказа</i>, по которому пришло <b>оповещение(E/4)</b>, продавец отпускает <b>товар(E/2)</b>, делая соответствующую <i>отметку в заказе</i>.
Покупатель может отказаться от покупки, тогда продавец делает в <b>заказе(E/3)</b> соответствующую <i>отметку в заказе</i>.
Кроме того, во всех <b>заказах(E/3)</b>, для которых <i>истек срок отпуска товара со склада</i>, продавец делает <i>отметку об аннулировании заказа</i>.
В этих случаях продавец корректирует <i>кол-во товаров на складе</i>.

Если поступило меньше <b>товаров(E/2)</b>, чем требовалось, часть <b>покупателей(E/1)</b> остается неудовлетворенной: при этом, если <b>товар(E/2)</b> поступает в магазин повторно, или остается не проданный по <b>заказам(E/3)</b> с <i>истекшим сроком</i>, <b>оповещение(E/4)</b> посылается неудовлетворенным <b>покупателям(E/1)</b>.

Кассир - отвечает за оформление оплаты <b>товаров(E/2)</b>.
Для оплаты <b>товара(E/2)</b>, <b>покупатель(E/1)</b> предъявляет кассиру <b>оповещение(E/4)</b>, в соответствии с которым определяется <i>стоимость покупки</i>.
Оплата <b>товара(E/2)</b> оформляется, если не истек <i>срок выкупа товара</i>. В этом случае кассир оформляет <b>документ об оплате(E/5)</b> (приходный кассовый ордер для <b>физ.</b> или входящее банковское платежное поручение для <b>юр. Лиц.</b>) в котором указывается <i>сумма оплаты</i>. 
Кроме того, в <b>оповещении(E/4)</b> кассир фиксирует <i>даты и время оплаты</i>, а также <i>номер документа об оплате</i>.

Заведующий - управляет работой отдела. Он осуществляет проверку состояния дел фирмы. Так, еже квартально выявляются клиенты, оставшиеся неудовлетворенными.

Итого:

+ Покупатель - Юр. Или част. Лицо, желающее преобрести или постоянно приобретающее какие-либо товары. Задаются <i>категория покупателя</i> (Юр. или Физ. лицо), <i>дата регистрации</i>.
+ Товар - Любое изделие промышленного производсва, когда-либо продаваемого отделом продаж. Указываются <i>наименование</i> и <i>артикул товара</i>, <i>номер сертификата качества</i>, <i>упаковка</i>, <i>название фирмы производителя</i> товара, <i>кол-во товара на складе</i>
+ Заказ - Документ, фиксирующий факт заказа товара на фирме. Содержит <i>дату и время оформления заказа</i>, <i>дату и время отправки первого оповежения</i>, <i>дату и время оплаты товара</i>, <i>дату и время отпуска товара со склада</i> или <i>метку об аннулировании</i>.
+ Оповещение - Документ, фиксирующий факт отправки покупателю сообщения о поступлении интересующего его товара. Содержит <i>дату и время отправки оповещения</i>, <i>номер заказа</i>, по которому оформлено оповещение.
+ Документ об оплате - Платежный документ, фиксирующий факт оплаты товара покупателем. Содержит <i>тип документа</i> (приходный кассовый ордер для физ. или входящее банковское платежное поручение для юр. Лиц.), <i>дату и время оплаты</i>, а также <i>сумму оплаты</i>.
+ Товарная накладная - Документ, фиксирующий поступление товара на склад. Содержит <i>дату поступления товаров</i>.
+ Юр. лицо - Любая комерческая фирма зарегестрированная в системе. Задаются <i>название фирмы</i>, <i>юр. адрес</i>, <i>телефон</i>, <i>номер лицезии</i>, <i>банковские реквизиты</i>, <i>категория фирмы</i> (магаз, оптовик, лоток и т.д.)
+ Физ. лицо - Любой гражданин Российской Империи. Задаются <i>Фамилия</i>, <i>имя</i>, <i>отчетсво</i>, <i>год рождения</i>, <i>паспортные данные</i>, <i>адрес</i>, <i>телефон</i>, <i>email</i>.

#### 0) Кандидаты в сущности

+ Покупатель (E/1) 
+ Товар (E/2) 
+ Заказ (E/3) 
+ Оповещение (E/4) 
+ Документ об оплате (E/5) 
+ Товарная накладная (E/6) 
+ Юр. лицо (E/7) 
+ Физ. лицо (E/8) 

#### 1) Связи

* Любой ПОКУПАТЕЛЬ может оформить один или несколько ЗАКАЗОВ
* ЗАКАЗ может оформить только один ПОКУПАТЕЛЬ

* ЗАКАЗ содержит один или несколько ТОВАРОВ
* ТОВАР находиться в одном или нескольких ЗАКАЗАХ

* ТОВАРНАЯ НАКЛАДНАЯ содежит один или несколько ТОВАРОВ
* ТОВАР находиться в одном или нескольких ТОВАРНЫХ НАКЛАДНЫХ

* ПОКУПАТЕЛЬ может получить одно или несколько ОПОВЕЩЕНИЙ
* ОПОВЕЩЕНИЕ высылается только одному ПОКУПАТЕЛЬЮ

* ЗАКАЗ находиться в одном или в нескольких ОПОВЕЩЕНИЯХ
* ОПОВЕЩЕНИЕ содержит информацию об одном ЗАКАЗЕ

* ДОКУМЕНТ ОБ ОПЛАТЕ содержит информацию об одном ЗАКАЗЕ
* ЗАКАЗ оплачивается по одному ДОКУМЕНТУ ОБ ОПЛАТЕ

* ОПОВЕЩЕНИЕ может содержать информацию об одном ДОКУМЕНТЕ ОБ ОПЛАТЕ
* ДОКУМЕНТ ОБ ОПЛАТЕ содержит информацию об одном ОПОВЕЩЕНИИ

* ПОКУПАТЕЛЬ может быть либо ЮР. лицом либо ФИЗ. лицом.

#### 2) Атрибуты

Покупатель (customer):
* номер покупателя (customer.customer_id) (PK)
* тип покупателя (customer.type_id)
* ФИО (customer_fio)
* дата регистрации (customer.date_registration)

Товар (product):
* код товара (product.product_id)
* наименование (product.name)
* артикул (product.article)
* номер сертификата качества (product.number_quality_certificate)
* упаковка (product.package)
* название фирмы производителя (product.manufacturer_name)
* кол-во на складе (product.count_in_storage)
* отпускная цена (product.selling_price)

Товарная накладная (waybill):
* номер накладной (waybill.waybill_number)
* дата поступления товара (waybill.datetime)
* кол-во поступивщего товара (waybill.total_product)
* всего отпущено на сумму (waybill.total_cost)

Поставка (delivery):
* номер поставки (delivery.delivery_id) PK
* номер накладной (waybill.waybill_number) FK
* код товара (product.product_id) FK
* дата и время поставки (delivery_datetime)
* кол-во товаров (order.count_products)

Позиция товара (position):
* номер позиции (position.position_id) PK
* номер заказа (order.order_id) FK
* код товара (product.product_id) FK

Заказ (order):
* номер заказа (order.order_id) PK
* номер покупателя (customer_id) FK
* дата и время оформления (order.datetime_registration)
* дата отправки первого оповещения (order.datetime_first_notify)
* дата и время оплаты (order.datetime_payment)
* крайний срок отпуска товара со склада (product.datetime_product_end)
* кол-во товаров (order.count_products)
* отметка о продаже(отмене) покупки товара (order.payment_status)
* стоимость покупки (order.cost)

Оповещение (notify):
* номер оповещения (notify.notify_id) PK
* номер заказа (notify.order_id) FK
* дата и время отправки оповещения (notify.datetime)
* крайний срок выкупа товара (notify.date_end_purchase)
* отметка об оплате товара (notify.is_paid)

Документ об оплате (quittance):
* номер документа об оплате (quittance.quittance_number)
* тип документа (quittance.type)
* дата и время оплаты (quittance.payment_datetime)
* сумма оплаты (quittance.payment_amount)

Юр. лицо (legal):
* название фирмы (legal.company_name)
* адрес (legal.address)
* телефон (legal.phone)
* номер лицезии (legal.license_number)
* банковские реквизиты (legal.bank_details)
* категория фирмы (legal.company_category)

Физ. лицо (person):
* фамилия (person.last_name)
* имя (person.first_name)
* отчетсво (person.middle_name)
* год рождения (person.date_birth)
* паспортные данные (person.passport_data)
* адрес (person.address)
* телефон (person.phone)
* email (person.email)

#### 3) триггеры

1) 

# Упражнения

## 2.1.1

Расмотрим проект БД банка, содежращей информацию о клиентах (назовем это множество сущностей <b>Clients</b>) и состоянии их счетов (<b>Accounts</b>). 

Данные о клиенте включают его имя (<b>name</b>), адрес (<b>address</b>), номер телефона (<b>phone</b>) и код полиса социального страхования (<b>ssnumber</b>).

Счет описывается атрибутами номера (<b>number</b>), типа (например "накопительный" "чековый", и т.п. (<b>type</b>)) и остатка (<b>balance</b>).

Необходимо также отобразить в БД факт принадлежности счета определенному клиенту. 

Начертите ER-диаграмму, соответвующую такой БД. Незабудте описать типы связей

#### 0) Кандидаты в сущности

* Клиент (Client)
* Счет (Account)

#### 1) Связи

* Любой КЛИЕНТ может иметь (или может не иметь) СЧЕТ в банке
* СЧЕТ должен принадлежать одному КЛИЕНТУ

Итого

* КЛИЕНТ имеет СЧЕТ
* СЧЕТ принадлежит КЛИЕНТУ

#### 2) Атрибуты

Клиент:
* Номер клиента (client.id)
* Имя клиента (client.name)
* Адрес клиента (client.address)
* Номер телефона клиента (client.phone)
* Полис клиента (client.ssnumber)

Счет:
* Код счета (account.id)
* Номер счета (account.number)
* Тип счета (account.type)
* Баланс счета (account.balance)

<img src="/static/img/books/erwin/ex1.png" alt="">

## 2.1.2

Исправте решение упр. 2.1.1 след. образом:
+ измените диаграмму в предположении, что счет может принадлежать только одному клиенту; 
+ измените диаграмму, предусматривая, что клиент может открыть в банке только один счет  

<img src="/static/img/books/erwin/ex2.1.2.png" alt="">  

+ измените исходную диаграмму, полученную в результате упраженния 2.1.2, в предположении, что клиент может иметь несколько адресов, описываемых кортежами вида "улица-город-страна", и множество номеров телефонов. Имейте в виду, что в рамках ER-модели вы не вправе использовать атрибуты типов, таких как множества, не являющимися атомарными.

<img src="/static/img/books/erwin/ex.2.1.2.2.png" alt="">  

<a href="https://github.com/Avis20/learn/blob/master/ermin/book/bank_er.erwin">git</a>

## 2.1.3

Представьте в виде ER-диаграммы структуру "фудбольной" базы данных, охватывающую информацию о командах, об игроках и о болельщиках, включая след. атрибуты

1. Для каждой команды - название, перечень имен игроков, имя капитана (из числа игроков), цвета формы
2. Для каждого игрока - имя
3. Для каждогов больельщика - имя, название комманды, имя любимого игрока и предпочитаемый цвет.


#### 0) Кандидаты в сущности

* Игрок
* Команда
* Цвет формы
* Болельщик

#### 1) Связи

* ИГРОК может находится в одной КОМАНДЕ
* КОМАНДА состоит из несольких ИГРОКОВ

* у КОМАНДЫ может быть ИГРОК капитан
* ИГРОК может быть капитаном КОМАНДЫ

* КОМАНДА должна иметь ЦВЕТ ФОРМЫ
* ЦВЕТ ФОРМЫ может принадлежать одной КОМАНДЕ

* БОЛЕЛЬЩИК болеет за одну КОМАНДУ
* за одну КОМАНДУ болеет нескольно БОЛЕЛЬЩИКОВ
* у БОЛЕЛЬЩИКА может быть любимый ИГРОК
* ИГРОК может быть любимым несколькими БОЛЬЕЛЬЩИКАМИ
* у БОЛЕЛЬЩИКА может быть любимый ЦВЕТ ФОРМЫ
* ЦВЕТ ФОРМЫ может быть любимым несколькими БОЛЬЕЛЬЩИКАМИ

#### 2) Атрибуты

Игрок:
* код игрока (PK)
* команда (FK)
* имя

Команда:
* код команды (PK)
* цвет формы (FK)
* капитан (FK)
* название

Цвет формы:
* код цвета (PK)
* цвет

Болельщик:
* код болельщика (PK)
* команда (FK)
* любимый игрок (FK)
* цвет формы (FK)
* имя

<img src="/static/img/books/erwin/ex2.1.3.1.png" alt="">  

<a href="https://github.com/Avis20/learn/blob/master/ermin/book/foodball_er.erwin">git</a>

## 2.1.4

Предположим, что в диаграмме решения упр. 2.1.3 следует предусмотреть связь led-by ("играл под руководством"), соединяющую двух игроков и команду. Множество данных для связи led-by состоит из кортежей вида `(player1, player2, team)`, свидетельствующих о том, что игрок "player1" играл в команде "team" в тот период, когда игрок "player2" был ее капитаном.

1. Внесите в ER-диаграмму необходимые изменения.
2. Замените тернарную связь led-by новым множеством сущьностей и набором бинарных связей.

## 2.1.5

Дополните диаграмму упр. 2.1.3 информацией о том, в каких командах игрок выступал прежде, включая даты зачисления в состав каждой команды и увольнения из нее.

<img src="/static/img/books/erwin/ex.2.1.5.png" alt="">  

## 2.1.6

Расмотрим задачу описания генералогического дерева семьи. Нам понадобиться одно множество сущьностей, People ("люди"). Информация, которую необходимо отобразить в модели, включает атрибут name ("имя") и след. связи: MotherOf ("является матерью"), FatherOf ("является отцом"), и ChildOf ("является ребенком").  
Постройте ER-диаграмму, состоящую из множества сущьностей People и при соединенных к нему соответствующих связей.  
Не забудьте воспрользоваться ролями, если множество сущьностей в контексте связи учавствует многократно.

## 2.1.7

Измените проект БД, созданный в упр. 2.1.6, включив в него описание след. спец. множеств сущьности "человек":

1. Женщины
2. Мужчины
3. Родители

## 2.1.8

Альтернативный способ решения задания упр. 2.1.6 состоит в применениии тернарной связи Family ("семья") в предложении, что кортеж множества данных для Family, выглядит как `(person, mother, father)`

1. Начертите ER-диаграмму
2. Замените тернарную связь Family множеством сущьностей и набором бинарных связей.

## 2.1.9

Спроектируйте структуру, адекватно описывающую универститетскую БД, которая должна включать информацию о студентах, факультетах, профессорах, курсах, а также о том, какие студенты слушают какие курсы и какие профессора преподают эти курты, какие курты читаются на том или ином факультете, об отметках студентов и лучих достижениях студентов по каждому курсу.


